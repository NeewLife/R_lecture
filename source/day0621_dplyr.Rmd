---
title: "2022-06-21메모(6장)"
output: html_document
date: '2022-06-21'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#6장
##데이터 전처리를 위한 도구(p.98)
-dplyr : 10GB 이내, 매우 쉬움, 처리속도 느림
-data.table : 50GB 이상, 어려움, 처리속도 빠름


-dplyr 라이브러리 불러오기
```{r}
install.packages("dplyr")
library(dplyr)
```

%>% : 파이프 연산자(코드와 코드를 이어줌 ctrl+shift+m)
filter : 행 추출(조건식)
group by : 
summarize() : 
```{r}
str(mpg1)
data2 <- mpg1 %>% 
  select(drv,cty,hwy) %>% 
  filter(drv == "f")
```
-파이프 연산자 안 쓸 경우
```{r}
data3 <- select(mpg1, drv, cty, hwy)
data3 <- filter(data3, drv == "f")
```

-rename() : 변수 이름 바꿔주기
```{r}
#기존데이터 <- 새 데이터 %>% rename(새 이름1=기존 이름1, 새 이름2=기존 이름2,...)
```

-count() : table()함수와 같지만 count()함수는 데이터프레임
table()함수는 테이블 형태로 출력
```{r}
count(mpg1, trans)
class(count(mpg1, trans))
```
-table() 함수는 데이터세트$변수 이다.
```{r}
table(mpg1$trans)
class(table(mpg1$trans))
```

-select : 필요한 열 추출
```{r}
#새 데이터세트 <- 데이터세트 %>% select(열1, 열2, ...)
mpg1_1 <- mpg1 %>% select(manufacturer, trans,cty)
#manufacturer,trans,cty 열만 추출
```
-열 삭제 응용(select 함수 안에 -c 함수로 삭제할 열을 입력)
```{r}
mpg1_2 <- mpg1 %>% select(-c(cty,hwy))
#cty,hwy 열이 삭제됨
```

-slice : 필요한 행 추출
```{r}
mpg1 %>% slice(1,4,5)
#1,4,5번 행을 추출한다. 연속적인 행이면 a:b로도 가능
```
-filter : 조건에 맞는 행 추출
```{r}
mpg1_hd1 <- mpg1 %>% filter(manufacturer=="hyundai")
#manufacturer가 'hyundai'인 행을 추출한다.
```
```{r}
max(mpg1$cty)
mpg1 %>% filter(cty==max(cty))
#cty의 최댓값이 35일 때, cty의 35(최댓값)인 행을 추출한다.
```
-비교값이 다른 데이터 추출
```{r}
mpg1_hd2 <- mpg1 %>% filter(manufacturer != "hyundai")
#manufacturer가 'hyundai'가 아닌 행을 추출한다.
```
-비교값이 크거나 작은 데이터 추출
```{r}
mpg1_hd3 <- mpg1 %>%filter(cty < mean(cty))
#cty값이 평균 미만인 자동차들을 추출한다.
```
-1사분위수와 비교
```{r}
quantile(mpg1$cty)
```
```{r}
mpg1_hd4 <- mpg1 %>% filter(cty<=14)
#cty값이 cty값의 1사분위값보다 작거나 같은 자동차들을 추출한다.
```
-크거나 같거나 수학연산자를 사용한다.(<=, >, !=, ...)

-'manufacturer=="honda"|manufacturer=="nissan"|manufacturer=="subaru"|manufacturer=="toyota"'는
'manufacturer %in% c("honda", "nissan", "subaru", "toyota")'로 해도 된다.
```{r}
mpg1_hd5 <- mpg1 %>% filter(manufacturer %in% c("honda", "nissan", "subaru", "toyota")) 
# %in% c()로 한번에 묶기
# %>% 이 아니라 %in% 이다.
```

glimpse() : 데이터 미리보기
mutate() : 새로운 파생변수 항목 만들기
```{r}
iris %>% 
  #Species, setosa versicolor
  filter(Species == "setosa") %>% 
  select(Sepal.Length, Sepal.Width) %>% 
  filter(Sepal.Length > 5.0) %>% 
  mutate(total = Sepal.Length + Sepal.Width) %>% glimpse()
# 여러 조건들을 한 뒤에 데이터 미리보기
# "%>% glimpse()" 대신 "<- iris2" 쓰면 작업한 데이터가 바로 iris2로 저장된다.
```
-&를 이용하여 반복되는 함수를 줄인다
```{r}
iris %>% 
  #Species, setosa versicolor
  filter(Species == "setosa" & Sepal.Length > 5.0) %>% 
  select(Sepal.Length, Sepal.Width) %>% 
  mutate(total = Sepal.Length + Sepal.Width)
#바로 위의 함수와 같은 함수지만 filter를 &로 정리했다.
#여러 조건일 때 &는 and, |는 or, !는 not
```

-group_by(trans) : trans 변수안의 범주로 행을 분류한다.
-summarise(m = mean(cty)) : cty의 평균을 m이라는 변수에 넣는다.
```{r}
mpg1 %>% 
  group_by(trans) %>% 
  summarise(avg     = mean(cty)   # 평균
            , total = sum(cty)    # 총합
            , med   = median(cty) # 중간값
            , count = n())        # 빈도
#group_by(), summarise() : 한 세트로 생각
```
-n() : 데이터숫자를 세어 빈도를 알려준다.(count함수와 비슷함.)

-count() 함수와 summarise(n=n()) 함수는 결과값은 같지만,
count()함수는 summarise()함수같이 여러 명령을 수행할 수 없고,
summarise(n=n())함수는 여러 명령을 수행할 수 있다.

```{r}
count(mpg1, trans)
#짧지만 여러 명령은 불가능..
```
```{r}
mpg1 %>% 
  group_by(trans) %>% 
  summarise(n=n())
#summarise(n=n()) 함수가 더 길지만, 여러 명령을 붙일 때 빛을 본다.
```

-group_by() + summarise(n())+ mutate()의 조합
```{r}
mpg1 %>% 
  group_by(trans) %>%       #trans범주로 분류
  summarise(n=n()) %>%      #trans범주별 데이터 빈도 구하기
    mutate(total=sum(n),    #trans범주별 빈도의 총계 구하기
          pct=n/total*100)  #trans범주별 비율 구하기
```

-if, else : if에 조건과 명령문을 쓰고, else에 다른 명령을 쓴다.
```{r}
#if(조건) {명령문A} else {명령문B}
#"조건이 참이면 명령문A를 수행하고, 아니면 명령문B를 수행하라"
```
-ifelse() : if조건에 참이면 수행하고, 거짓이면 else를 해라.
```{r}
a <- c(1,3,4,6,9)
ifelse(a%%2==0, "짝수", "홀수")
#벡터연산 가능
```


  
  